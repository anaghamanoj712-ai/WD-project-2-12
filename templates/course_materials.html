{% extends "base.html" %}

{% block title %}{{ course_name }} - Study Materials{% endblock %}

{% block extra_css %}
<style>
    .back-button {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: #1a1a1a;
        color: #fff;
        padding: 10px 20px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        margin-bottom: 20px;
        transition: all 0.3s ease;
        border: 1px solid #333;
    }
    
    .back-button:hover {
        transform: translateX(-4px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        background: #252525;
    }
    
    .course-header {
        background: linear-gradient(135deg, #667eea 0%, #5a6fd8 100%);
        border: 1px solid #2a2a2a;
        border-radius: 16px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }
    
    .course-code-badge {
        display: inline-block;
        background: #1a1a1a;
        color: white;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 700;
        text-transform: uppercase;
        margin-bottom: 10px;
    }
    
    .course-header h1 {
        color: #fff;
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 8px;
    }
    
    .course-header p {
        color: rgba(255,255,255,0.8);
        font-size: 14px;
        margin: 0;
    }
    
    .materials-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 20px;
    }
    
    .material-card {
        background: #1a1a1a;
        border: 1px solid #2a2a2a;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
    }
    
    .material-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0,0,0,0.2);
    }
    
    .material-title {
        font-size: 20px;
        font-weight: 700;
        color: #fff;
        margin-bottom: 8px;
    }
    
    .material-date {
        font-size: 12px;
        color: #888;
        margin-bottom: 12px;
    }
    
    .material-description {
        color: #d0d0d0;
        font-size: 14px;
        line-height: 1.6;
        margin-bottom: 16px;
        padding: 12px;
        background: #252525;
        border-radius: 8px;
        border: 1px solid #333;
    }
    
    .material-link-section {
        background: linear-gradient(135deg, #667eea 0%, #5a6fd8 100%);
        padding: 16px;
        border-radius: 12px;
        margin-bottom: 16px;
    }
    
    .link-label {
        color: white;
        font-size: 11px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 10px;
    }
    
    .open-link-button {
        display: block;
        width: 100%;
        background: #1a1a1a;
        color: #fff;
        padding: 14px 20px;
        border-radius: 8px;
        text-align: center;
        text-decoration: none;
        font-weight: 700;
        font-size: 16px;
        transition: all 0.3s ease;
        cursor: pointer;
        border: none;
    }
    
    .open-link-button:hover {
        transform: scale(1.02);
        box-shadow: 0 4px 16px rgba(0,0,0,0.3);
        background: #252525;
        color: #fff;
    }
    
    .link-url {
        color: rgba(255,255,255,0.8);
        font-size: 11px;
        margin-top: 8px;
        word-break: break-all;
        line-height: 1.4;
    }
    
    .uploader-info {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #888;
        font-size: 13px;
        padding-top: 12px;
        border-top: 1px solid #333;
    }
    
    .no-materials {
        background: #1a1a1a;
        border: 1px solid #2a2a2a;
        border-radius: 16px;
        padding: 60px 30px;
        text-align: center;
        box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }
    
    .no-materials h3 {
        color: #fff;
        font-size: 24px;
        margin-bottom: 12px;
    }
    
    .no-materials p {
        color: #999;
        font-size: 16px;
    }
    
    .sort-controls {
        background: #1a1a1a;
        border: 1px solid #2a2a2a;
        border-radius: 12px;
        padding: 16px 20px;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        color: #fff;
    }
    
    .sort-controls select {
        padding: 8px 12px;
        border: 1px solid #4a5a4a;
        background: #121212;
        color: #e0e0e0;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
    }
    
    .materials-count {
        color: #888;
        font-weight: 600;
        font-size: 14px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <a href="{{ url_for('study_materials') }}" class="back-button">
        ‚Üê Back to Courses
    </a>
    
    <div class="course-header">
        <span class="course-code-badge">{{ course_code }}</span>
        <h1>{{ course_name }}</h1>
        <p>Access all study materials and resources for this course</p>
    </div>
    
    <div class="sort-controls">
        <div>
            <label for="sortSelect" style="margin-right: 10px; font-weight: 600;">Sort by:</label>
            <select id="sortSelect" onchange="changeSorting()">
                <option value="date_desc" {% if sort_by == 'date_desc' %}selected{% endif %}>Newest First</option>
                <option value="date_asc" {% if sort_by == 'date_asc' %}selected{% endif %}>Oldest First</option>
                <option value="name_asc" {% if sort_by == 'name_asc' %}selected{% endif %}>Name (A-Z)</option>
                <option value="name_desc" {% if sort_by == 'name_desc' %}selected{% endif %}>Name (Z-A)</option>
            </select>
        </div>
        <div class="materials-count">
            {{ materials|length }} Material{% if materials|length != 1 %}s{% endif %}
        </div>
    </div>
    
    {% if materials %}
    <div class="materials-container">
        {% for material in materials %}
        <div class="material-card">
            <div class="material-title">{{ material['title'] }}</div>
            <div class="material-date">üìÖ {{ material['created_at'].strftime('%Y-%m-%d %H:%M') if material['created_at'] and material['created_at'].strftime is defined else material['created_at']|string|truncate(16, True, '') }}</div>
            
            {% if material['description'] %}
            <div class="material-description">{{ material['description'] }}</div>
            {% endif %}
            
            {% if material['file_path'] %}
            <div class="material-link-section">
                <div class="link-label">üìé Study Material</div>
                <a href="{{ (material['file_path'] or '')|trim }}" 
                   target="_blank" 
                   rel="noopener noreferrer" 
                   class="open-link-button"
                   onclick="window.open(this.href, '_blank'); return false;">
                    üîó Open in New Tab
                </a>
                <div class="link-url">{{ (material['file_path'] or '')|trim }}</div>
            </div>
            {% else %}
            <div style="padding: 12px; background: #fff3cd; border-radius: 8px; color: #856404; font-size: 13px;">
                ‚ö†Ô∏è No link available for this material
            </div>
            {% endif %}
            
            <div class="uploader-info">
                <span>üë§</span>
                <span>Uploaded by {{ material['uploader_name'] if material.get('uploader_name') else 'Professor' }}</span>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="no-materials">
        <h3>üìö No Materials Available</h3>
        <p>Study materials for {{ course_name }} will appear here once uploaded by your professor.</p>
    </div>
    {% endif %}
</div>

<script>
    function changeSorting() {
        const sortBy = document.getElementById('sortSelect').value;
        const url = new URL(window.location.href);
        url.searchParams.set('sort', sortBy);
        window.location.href = url.toString();
    }
    
    // Debug: Log all materials data
    console.log('Course Materials Data:');
    {% for material in materials %}
    console.log({
        id: {{ material['id'] }},
        title: {{ material['title']|tojson }},
        file_path: {{ (material['file_path'] or '')|trim|tojson }},
        has_link: {{ 'true' if material['file_path'] else 'false' }}
    });
    {% endfor %}
</script>
{% endblock %}